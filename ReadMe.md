# 本リポジトリについて
本リポジトリでは、個別指導塾におけるDXの一環として、教務スタッフのシフト提出からコマの割り振りまでのワークフロー改善を行いました。それにより、社員の割り振りプロセスの時間短縮やシフト調整の幅が格段に上昇しました。そのため、この事例をもとに多くの現場で導入できるように、本リポジトリを公開させていただきました。

# 開発環境について
本システムの開発に使用しているローカル環境は以下の通りです。   

> PC: `Apple MacBook Air M1 2020モデル`   
>利用ツール: `Visual Studio Code`, `Google Spread Sheet`, `Google Colaboratory`, `Line`   
>開発言語: `Python`   
>利用しているライブラリ: `Pulp`, `Pandas`, `Openpyxl`

# 1. 問題要件定義
## 1.1 システム化の目的
本プロジェクトでは、現在のシフト管理フローについて課題な負担が生じており、提供するサービスの質悪化に繋がりかねないと判断したため、新システムを構築し、導入する。
## 1.2 背景
私の勤務している個別指導塾では、以下の問題が生じている。
1. シフト提出についての問題
    * シフト提出が紙ベースであり、提出後に社員がエクセルへの入力作業を行うため無駄が生じている。
    * 生徒の予定についても紙面で回収し、同様にpcへ転記している。
    * 教室pcのデータが共有サーバ上にあり、教室内でしか提出したシフトを確認できない。
    * 勤務予定を集約するファイルへのアクセス権限を有するスタッフが限られている。
    
    * シフト提出期間に出勤予定がないスタッフもいるため、コマの割り振りが後に伸びてしまう。
2. コマの割り振りにおけるワークフロー
    * 講師の出勤日程と指導科目, 生徒の来塾可能日程,受講科目,受講コマ数などの制約条件が多い。
    * 振替のコマもあるため、複雑化しやすい
    * コマの割り振り用ファイルへのアクセス権限を有するスタッフが限られるため、確認しにくい。
    * コマの割り振りが延滞することで、授業準備ができずに授業を実施することが多い。
    * コマの割り振りのためのマクロが使われているエクセルファイルがあるものの、使い勝手が悪い。
    * 教室の改装によりブース数が変化するものの、現行のシステムでは対応不可能。
## 1.3 ワークフロー改善における狙い
* シフト提出からコマの割り振りにおけるフローの効率化
* コマの割り振り業務の負担軽減
* 授業状況の共有の易化
* 情報伝達における人為的なミスの減少
## 1.4 ビジネスプロセス関連図
現行のビジネスプロセスについて以下に示す。
<!---後に記述します。-->

## 2. 画面遷移図
画面遷移図を以下に示す。

![画面遷移図](https://github.com/yut0takagi/LP_class/blob/main/fig/%E7%94%BB%E9%9D%A2%E9%81%B7%E7%A7%BB%E5%9B%B3.png?raw=true "Giithub")

### 2.1. 個人情報の編集

### 2.2. シフトの提出

### 2.3 生徒管理
#### 2.3.1. 授業割り振り画面
授業割り振りは、当初掲げていた改善すべきタスクの中で特に重視すべき問題である。そこで、以下のように改善策を講じた。
1. *線形計画法*による一定期間のコマの割り振り業務効率化   
    * 線形計画法とは   
        線形計画法とは、ORの最適化手法の一つである。
    * 本タスクへの当てあめ   
        線形計画法では、目的関数と制約条件を定める必要がある。それぞれ、以下のように定義した。
        1. 制約条件について   
            1. *$生徒i$について*   
                * 生徒iが同一の授業時間に複数の授業を受けることができない。
                * 生徒iの授業数は受講申請した授業数と等しくする必要がある。
                * 生徒iの授業は、来塾可能授業時間でなければならない
                * 生徒iの来塾可能日程の回収ができていない場合、授業割り当てができない。
            2. *$講師j$について*   
                * 講師jが同一の授業時間に指導できる生徒数は$C_j$以下である。
                * 講師jが勤務できる授業時間でなければ授業を開講できない
                * 講師jが指導できる教科意外の授業は担当できない
            3. *教室状況,法的観点について*   
                * 稼働講師数は、ブース数以下にする必要がある。
                * 労働基準法により、講師jの週稼働時間が40時間以内にする必要がある。
                * 労働基準法により、講師jの一日の稼働時間が8時間以内にする必要がある。
                * 労働基準法により、講師jの一日の生徒指導時間が6時間以上の場合は、休憩時間1時間を開室時間内に取る必要がある。

        2. 目的関数
            生徒の実施授業の割り当ての分散が最大となる割り当てを最適な割り当てとする。
            具体的には、生徒iの単位期間内の授業数が$n$であり実施日が $$[day_1, day_2, day_3, day_4,,,day_n]$$ である時、それらの分散は以下のように定義できる。   

            $$ Var(x) = \frac{1}{n}\sum_{k=1}^{n}(day_k - \frac{1}{n}\sum_{s=1}^{n}day_s)^2$$ 

            よって、目的変数は、すべての生徒での当該分散の総和と言えるため、以下のように定義する。

            $$ \sum_{i=1}^{I}Var(i) = \sum_{i=1}^{I}( \frac{1}{n}\sum_{k=1}^{n}(day_k - \frac{1}{n}\sum_{s=1}^{n}day_s)^2)$$ 
          


    * 授業










<br>
<br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br>

1. 教務スタッフの情報を定義
    1. 教務スタッフのyyyy年mm月dd日のnコマ目の入室可否のデータを変数として定義
        ```Python
        teachername_PossTime_yyyymmddn = pulp.LpVariable("teachername_PossTime_yyyymmddn",0,1,"Integer")
        ```
    2. 教務スタッフの科目コードabcdeの授業実施可否についてのデータを定義
        ```Python
        teachername_PossSubject_abcde = pulp.LpVariable("teachername_PossSubject_abcde",0,1,"Integer")
        ```
2. 環境因子の設定
    1. 教室の利用可能ブース数についての定義
        ```Python
        room_n_poss_yyyymmddn = pulp.LpVariable("room_n_poss_yyyymmddn",0,5,"Integer")
        ```
    2. 最大可能授業講師数
        該当時間における最大講師数の定義を行う。例えば、教室のブースが5つ空いている場合は、最大可能授業講師数は5になる。
        ```Python
        booth_num_yyyymmddn = pulp.LpVariable("booth_num_yyyymmddn",0,5,"Integer")
        ```
    3. 講習期間の定義   
        * 開始日: 2024/2/21
        * 終了日: 2024/3/31
        ```Python
        day_open_yyyymmddn = pulp.LpVariable("day_open_yyyymmddn",0,1,"Integer")
        ```
3. 生徒情報の定義
    生徒の来塾可能日程や履修科目やコマ数等について定義する。
    1. 来塾可能日程についての定義
    2. 履修科目の定義
    3. 残りコマ数の定義
    4. 主要な科目担当者の定義
    5. 生徒の情報(学年や性別等,NG講師等)の定義
    6. 備考
    