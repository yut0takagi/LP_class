# 0. 本リポジトリについて
本リポジトリは、個別指導塾での業務効率化について生じていた課題とその改善についてまとめたものです。DX推進等について実務経験があるわけではなく見よう見真似で実装したものになりますので、参考程度に使ってくださると嬉しいです。よろしくお願いいたします。

# 1. 問題要件について
##  1.1. 現時点(2024年7月12日)で生じている課題
1. <strong>コマの割り振りにおける業務負荷が高く細分化しにくいこと</strong><br>
    当該個別指導塾においてコマの割り振り業務は社員一人が行なっている。具体的には、塾生の来塾可能日程と教務スタッフの出勤可能日程を回収し、それらをもとに教室PCで組んでいく。その中で、生徒の受講科目に対して指導できる教務スタッフが不足していたり生徒,教務スタッフともに来塾可能であるにもかかわらずブースが足りなかったりするなど懸念点,制約条件が多く存在している。そのため、日程が全て完成することはなく常に三日前までに完成させることを目標に実施している状態である。よって、次の来塾日がわからない生徒や教務スタッフの授業準備が厳かになる等の問題が生じており、品質が低下しかねない状況に陥っていた。
2. <strong>シフト提出や日程調査用紙が紙ベースであること</strong><br>
    それらの書類が紙面でやりとりされることに関しては、デジタル化など言われているが受け渡しが楽であり効率が良いのであれば問題視するほどではない。しかし、当該個別指導塾ではそれらの書類を回収してから教室PCのエクセルファイルに転記し、本部へ送る書類とコマの割り振り結果の出力書類を作成している。さらに、転記先のエクセルファイルのフォーマットが操作し難い形式となっており、転記に約2日かかっていた。さらに、その転記を行える教室PCは1台しかないため業務細分化を行えず社員が黙々とやらざるを得ない環境となっていた。そのため、転記の作業が自動化等できれば負担を軽減することができると考える。それに加えて、それらの書類が紙ベースであるからこそ編集,更新,確認くをしにくいという問題が生じている。提出後は一人の社員が管理しており入力状況について他のスタッフが知ることができないため、確認することが困難となる。しかし、小学生から高校生をクライアントとする企業であるからこそ、提出した内容を再度確認,変更したいと申し出る生徒が多数いる。さらに、記入するフォーマットがそれぞれの生徒で異なる(来塾不可能な日にちに斜線を引く生徒と来塾可能な日にちに線を引く生徒,三角を使う生徒,途中までしか記入しない生徒等)などにより入力作業が停滞することが多々ある。しかし、生徒への確認は生徒が来塾していなければできないため非常に非効率な作業となる場合が多い。そのため、紙ベースでの回収には改善する必要があると感じた。
3. <strong>教務スタッフの研修,ミーティング不足</strong><br>
    教務スタッフの研修については、初期研修として採用から1ヶ月間と定期研修として月1回程度行うのが望ましい。そして、定期ミーティングを実施し受験の動向や教務指導の中でのTipsやベストプラクティス,当該個別指導塾ならではの技術共有などをすることで、他者との差別化や品質の向上が望める。しかし、当該個別指導塾では、コマの割り振り業務に社員が追われており全体での情報共有が活発でないなどの理由からミーティングの実施は無くなった。さらに、初期研修ではアルバイトが担当することが頻繁にあり、指導技術が一つの組織として共有されているのではなく完全に属人化してしまっている。そのため、教務指導スタッフの当たり外れが大きいと述べる生徒も多々いる。よって、組織としての統一感をもつ必要がありそれらを共有,享受することを目的としたイベント(ミーティングや研修,指導マニュアルの読み込み等)を実施するべきであると考えた。
4. <strong>マニュアルの不足</strong><br>
    3の内容と酷似するのだが、当該個別指導塾では、指導マニュアルやコマの割り振りマニュアル,組織のICT機器の操作方法に関する明確なマニュアルがなく口頭で伝える傾向になっている。そのため、現環境を維持するために保守的になっている部分があり変革しづらい環境と言える。また、春の時期で教務スタッフの入社タイミングであるのにもかかわらず作成されていないため、非常に働きにくい環境であると言える。

# 2. 具体的な導入システムの設計とその内容
## 2.1. Google Spreadsheetによるシフト管理システムの導入とその運用について(ver.1)
### 開発環境について
本システムの開発に使用しているローカル環境は以下の通りです。   

> 開発用PC: `Apple MacBook Air M1 2020モデル`   
> 教室用PC: `Lenovo ThinkStation`<br>
> 開発時利用ツール: `Google Spread Sheet`   
> 開発時利用言語: `GAS`<br>
> 動作可能環境: `Google Chrome` , `Safari`,`Firefox`

### 2.1.1 各種機能について
1. Google Spread Sheet でのシフト管理
    Google Spread Sheetを共有し、編集権限を限定付与することでシフト提出をオンライン上で行いました。
    運用したシートは以下のサイトから閲覧可能としております。ただし、スタッフ氏名等は変えております。
    ```url
    https://docs.google.com/spreadsheets/d/1RhHQKz_VnE5092DTtkHDm88jv8AuY55PCxYU0BiCSa4/edit?usp=sharing
    ```
    各種ページは以下のとおりです。
    1. <storng>マニュアルページ</storng><br>
        マニュアルページでは、操作方法の説明や動作環境等についてまとめました。
        当該個別指導塾で勤務している教務スタッフは大学生が多く、Lineグループでのアンケート機能を用いた事前調査の中でOffice関連の操作方法はある程度理解している方が多いとわかりました。
        そのため、私が退職しても運用,変更等行えるようにマニュアルとして各種機能をまとめることとしました。その中で、操作を画面録画として保存しGoogleDriveの共有フォルダーにアップロードしておくことで、理解しやすくなると考え、そのリンクをSpreadSheetに掲載することとしました。

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E3%83%9E%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%AB.png)
    
    2. <storng>勤務可能者検索</storng><br>
        シート2枚目には、勤務可能者検索シートを挿れました。当該個別指導塾では教務スタッフの約8割を大学生が占めています。
        そのため、大学の予定等で出勤が急遽難しくなった場合代行者を探す必要があります。
        しかし、先に述べたとおり他の教務スタッフがいつ出勤するのか把握することが困難でした。
        よって、本シートを全教務スタッフの勤務可能調査表と連携することで「誰がいつ出勤できるか」,「この日にこの科目を教えられる人は誰がいるのか」などを表形式で確認できるようにしました。
        さらに、教室でのPCによる代行者検索が頻繁に起きていたため、講師名や出勤可能日,科目等を選択式にして素早く操作できUXの向上を行いました。
        そして、前日や次の日をボタンで操作できる用意するために以下のコードをGoogleAppScriptで実行するようにしました。
        ```GAS
        function addOneDay() {
            var sheet = SpreadsheetApp.getActive().getSheetByName("勤務可能者検索")
            var dateValue = sheet.getRange("B7").getValue();
            dateValue.setDate(dateValue.getDate() + 1);
            sheet.getRange("B7").setValue(dateValue);
        }
        function minusOneDay() {
            var sheet = SpreadsheetApp.getActive().getSheetByName("勤務可能者検索")
            var dateValue = sheet.getRange("B7").getValue();
            dateValue.setDate(dateValue.getDate() - 1);
            sheet.getRange("B7").setValue(dateValue);
        }
        ```

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E5%8B%A4%E5%8B%99%E5%8F%AF%E8%83%BD%E8%80%85%E6%A4%9C%E7%B4%A2%E7%94%BB%E9%9D%A2.png)

    3. <storng>開講コマ設定</storng><br>
        当該個別指導塾では、開講する予定の日時と時間を事前に本部へ提出する必要がありました。
        また、全てを一括で管理するツールがないため、開講する予定でない時間に授業を入れてしまう等のミスが生じやすく振替を組む作業で時間を無駄に費やしてしまうことがありました。
        そのため、申請した開講情報を当該GoogleSpreadSheetに添付することで振替作業や代行検索を楽に行えるようにしました。
        そして、本シートは全てチェックボックスでの入力に書式を限定しており、そのにゅうりょhう情報をもとに勤務可能者検索のページの各セルの背景色を変更するなどの設定を行いました。
        具体的には、m月d日n限目のコマが開講していない場合は背景色を灰色にするなど設定しております。

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E9%96%8B%E8%AC%9B%E3%82%B3%E3%83%9E%E8%A8%AD%E5%AE%9A%E7%94%BB%E9%9D%A2.png)

    4. <storng>管理画面</storng><br>
        管理画面では、講師の追加と削除,シフト提出の該当期間,コマの設定時間,ブース数の設定,受け入れしている学年区分などを指定できるようにしました。
        さらに、勤務可能調査表を編集した際にChengeLogに追加される変更履歴をもとに最終確認日以降に変更された部分を明記する仕組みを取り入れました。
        そして最終更新日を本日にするボタンをGoogleAppScriptで記述し実行するようにしました。
        
        ```GAS
        function setDay(){
            var timeStamp = new Date();  // 現在の時刻
            var sheet = SpreadsheetApp.getActiveSheet();
            sheet.getRange("I3").setValue(timeStamp);
        }
        ```

        以前では、Lineにて社員の方に変更内容を逐一送り紙面と教室PC上で変更作業を実行していたため、勝手に知らない間に変更等は起こりませんでした。
        しかし、GoogleSpreadSheetを利用することでいつでも変更できるというメリットがある反面その変更が周知されておらず、後からタスクが増えてしまうことがありました。
        そのため、ChangeLogを利用して把握できるようにしました。
        そして、シフト提出状況を一括で把握できるように、各シートの入力状況を表と棒グラフで把握することができるようにしました。
        将来的には、シフト提出からコマの割り振りまでを行えるようにしたかったので、ブース数の指定や教室に関する情報を一枚のシートで管理できるようにしました。
        また、教務スタッフが新たに増えた場合は、シフト提出用のシート(氏名_勤務可能調査表)を作成し、講師指導科目のシートに一行追加するなどの作業が必要となります。
        ただ、各シートで記述している関数の中で正規表現を利用しているものが多くあるため入力ミス等が起こり適正な動作をしなかったり全体が小さなミスで使えなくなったりしてしまう場合が多かったです。
        そのため、全ての作業をGoogleAppScriptの関数として設定し、トリガーを管理画面に追加することで上記の操作を自動化しました。実行するGoogleAppScriptのコードは以下のとおりです。
        ```GAS
        function duplicateSheetWithPrompt() {
            var ss = SpreadsheetApp.getActiveSpreadsheet();
            var sheetA = ss.getSheetByName("temp");
            if (!sheetA) {
                Logger.log("指定したtempが見つかりません。管理者へお伝えください。");
                return;
            }
            var ui = SpreadsheetApp.getUi();
            var response = ui.prompt(
                "新規に作成するスタッフ名を入力してください。",
                "ここに入力：",
                ui.ButtonSet.OK_CANCEL
            );
            if (response.getSelectedButton() == ui.Button.OK) {
                var newSheetName = response.getResponseText();
                var newSheet = sheetA.copyTo(ss).setName(newSheetName + "_勤務可能調査表");
                newSheet.getRange("A1").setValue(newSheetName);
            } else {
                Logger.log("シート複製をキャンセルしました。");
            }
        }
        ```

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2.png)

    5. <storng>ChangeLog 変更履歴自動記録画面</storng><br>
        管理画面の項で示した通り、変更履歴を自動で記録するシートを導入しました。
        初期の段階では、変更したら変更箇所を各自記入するようにしていましたが、面倒であり入力作業を忘れる等のミスが多発しました。
        そこで、GoogleAppScriptを用いて自動で記録するような関数を以下のようにコーディングして、運用しました。

        ```gas
        function onEditRecordLogAAA(e) {
        // --------------------------------------------------------------------------------
        // 1. 編集されたシート名をチェック
        // --------------------------------------------------------------------------------
        var editedSheet = e.range.getSheet();
        var editedSheetName = editedSheet.getName();
        // シート名に "勤務可能調査表" が含まれていない場合は処理しない
        if (editedSheetName.indexOf("勤務可能調査表") === -1) {
            return;
        }
        // --------------------------------------------------------------------------------
        // 2. ログを残すシートを指定
        // --------------------------------------------------------------------------------
        var ss = SpreadsheetApp.getActiveSpreadsheet();
        var logSheetName = "ChangeLog";
        var logSheet = ss.getSheetByName(logSheetName);
        // もしログ用シートが存在しない場合はスキップ or 必要に応じて作成
        if (!logSheet) {
            Logger.log("ログシート '" + logSheetName + "' が存在しません。");
            return;
        }
        // --------------------------------------------------------------------------------
        // 3. 変更されたセル情報を取得
        // --------------------------------------------------------------------------------
        var editedRange = e.range;             // 変更されたセル範囲 (Rangeオブジェクト)
        var oldValue = e.oldValue;            // 変更前の値 (インストール型トリガー必要)
        var newValue = e.value;               // 変更後の値 (インストール型トリガー必要)
        var cellA1Notation = editedRange.getA1Notation();
        // --------------------------------------------------------------------------------
        // 4. 編集ユーザーを取得 (環境によって取得できない場合あり)
        // --------------------------------------------------------------------------------
        var userEmail = (e.user) ? e.user.getEmail() : "不明";
        // --------------------------------------------------------------------------------
        // 5. ログの書き込み
        // --------------------------------------------------------------------------------
        var timeStamp = new Date();  // 現在の時刻
        var write_sheet = "_勤務可能調査表"
        var manageSheet = SpreadsheetApp.getActive().getSheetByName("管理画面")
        for (let i = 18; i < 35; i++) {
            if (editedSheetName ==  manageSheet.getRange("B"+i).getValue()+ write_sheet){
            manageSheet.getRange("D"+i).setValue(timeStamp)
            }
        }

        logSheet.appendRow([
            timeStamp,            // A列: 日時
            editedSheetName,      // B列: シート名
            cellA1Notation,       // C列: 変更セル(A1表記)
            oldValue,             // D列: 旧値
            newValue,             // E列: 新値
            userEmail             // F列: ユーザー
        ]);
        }
        ```

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/ChangeLog%20%E5%A4%89%E5%B1%A5%E6%AD%B4%E8%87%AA%E5%8B%95%E8%A8%98%E9%8C%B2%E7%94%BB%E9%9D%A2.png)

    6. <storng>簡易確認シート</storng><br>
        シフト提出されたシートを移動して確認する作業が非常に面倒であるため、確認用のシートを作成しました。
        具体的にはA1セルの氏名を選択すると該当する講師の勤務可能状況を見ることができるようにしています。

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E9%96%8B%E8%AC%9B%E3%82%B3%E3%83%9E%E8%A8%AD%E5%AE%9A%E7%94%BB%E9%9D%A2.png)

    7. <strong>指導可能科目入力画面</strong><br>
        教務スタッフがお互いの授業を見るといった機会が少なく、「誰がどの科目をどのレベルまで指導できるのか」を把握することができませんでした。
        そのため、コマの割り振り後に、指導負荷であることが判明し代行を探すなどのミスが多発していました。そのため、本ファイルを導入してから1週間以内に入力をお願いし、勤務可能者検索の画面等へ反映できるようにしました。

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E6%8C%87%E5%B0%8E%E5%8F%AF%E8%83%BD%E7%A7%91%E7%9B%AE%E5%85%A5%E5%8A%9B%E7%94%BB%E9%9D%A2.png)

    8. <strong>出勤可能時間時間入力画面(講師1_勤務可能調査表)</strong><br>
        シフト提出を行うシートです。入力,変更を全てチェックボックスで選択式にすることで、入力エラーがないようにしました。
        本シートが各職員分作成し、各シートにそれぞれ入力してもらうようにしました。
        また、シートの作成は初期をPythonのOpenPyxlで行い作成しました。その後、職員の追加等を行う際には、GoogleAppScriptでtempシートをコピーし作成するようにしました。
        初期の作成用コードは以下の通りです。
        ```Python
        import openpyxl
        from datetime import date
        path = "Path/to/勤務調査_調査用SS.xlsx"
        wb = openpyxl.load_workbook(path,data_only=False)
        ws_template = wb["temp"]
        # シートの選択を解除
        for ws in wb.worksheets:
            ws.sheet_view.tabSelected = None
        ws_template = wb["temp"]
        teachers_list=["講師名1","講師名2",]
        for teacher in teachers_list:
            ws_copy = wb.copy_worksheet(ws_template)
            ws_copy.title = f'{teacher}_勤務可能調査表'
            ws_copy.cell(1,1).value = teacher
            wb.move_sheet(ws_copy, offset=len(wb.sheetnames))
        wb.active = 0
        # ブック名を変更して保存
        wb.save('勤務調査_変更後new.xlsx')
        ```

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E5%87%BA%E5%8B%A4%E5%8F%AF%E8%83%BD%E6%99%82%E9%96%93%E5%85%A5%E5%8A%9B%E7%94%BB%E9%9D%A2(%E8%AC%9B%E5%B8%AB1_%E5%8B%A4%E5%8B%99%E5%8F%AF%E8%83%BD%E8%AA%BF%E6%9F%BB%E8%A1%A8).png)

### 2.1.2. 実装後、運用期間について　
    2024年10月に運用を開始し、そこから2ヶ月間の使用しました。そして、ミーティングとLineのアンケート機能を用いてフィードバックを行った結果、以下の問題が挙げられました。

    1. Google App Scriptのトリガー機能をPC以外の機器から利用できないこと
    2. Google Spreadsheetで入力する際、選択式にしていても、スマートフォンで操作すると入力タブが表示されてしまい、選択しにくいこと。
    3. スマートフォン端末でGoogle SpreadSheetでスクロールする際に、セルを選択してしまい使いづらかった。
    4. シフトの提出がオンラインでできるようになり、いつでも閲覧できるため提出業務が楽になった。
    5. シフトの割り振り業務や本部へ送信する書類の作成は教室PCで行う必要があったため、シフトの転記はする必要があった。
        ※ 入室可否について全てフォーマット通りに提出できているため再度確認する必要がなくなったのはよかった。
    6. 生徒からの来塾可能日の調査もGoogle Spread Sheetで行えるようにすれば、集約できて良いのではないか
    8. シフト提出のプロセスの見直しができたため、他の部分でも効率化できる部分があるのではないか

## 2.2. Webアプリによるシフト提出からコマの割り振り,授業の管理まで改善(Ver.2)
### 開発環境について
本システムの開発に使用しているローカル環境は以下の通りです。   

> 開発用PC: `Apple MacBook Air M1 2020モデル`   
> 教室用PC: `Lenovo ThinkStation`<br>
> 開発時利用ツール: `VSCode`, `` , `Google Spread Sheet`   
> 開発時利用言語: `Python`, `SQL`, `HTML`, `CSS`, `JavaScript`<br>
> 動作可能環境: `Google Chrome` , `Safari`

### 2.2.1. 改善するべき課題について
* シフト提出ツールの操作性向上
    GoogleSpreadsheetではPCからだと操作しやすいが、スマートフォンからのアクセスが主流となっているため、スマートフォンからのアクセスを標準的に想定するべきであると考えました。
* シフト提出からコマの割り振り,本部への提出書類の作成までのプロセスを一元管理できる仕組み
    シフト管理はオンラインでできて教務スタッフ(アルバイト)は楽であるが、社員の業務負担軽減にはつながっていないとわかりました。そのため、シフトが提出されてからの工程においても完了できる仕組みづくりが重要であるとわかりました。
* Lineなどから容易に変更,把握できる仕組み
    Lineなどの身近な送受信を用いて変更できれば、代行検索や多くの指示が効率的になると考えます。
* 授業評価システム
    生徒の授業方針について各担当の教務スタッフによる独断の裁量となっているため、当該個別指導塾である価値が薄れ属人化が進んでしまっています。そのため、授業方針や授業単元について相談できるAIを活用したシステムの構築が望ましいと考えました。

### 2.2.2. 画面遷移図
画面遷移図は以下の通りです。
※SVGファイルであるため、背景が黒くなってしまう場合がございます。
![画面遷移図](https://github.com/yut0takagi/LP_class/blob/main/fig/%E7%94%BB%E9%9D%A2%E9%81%B7%E7%A7%BB%E5%9B%B3_2025_02_16.svg "Giithub")

### 2.2.3. 各種機能一覧




<hr>
<h1> ReadMe(ver.1)からの引き継ぎ部分</h1>
# 要旨
## 本リポジトリについて
本リポジトリは、個別指導塾での業務効率化,サービス品質向上の一環で作成した学習支援,学習管理システムの作成,策定プロセスを明記したものです。<br>
具体的には、以下のプロセスについての業務効率化,サービス提供を行っております。<br>

1. 教務スタッフのシフト提出と通塾生の通塾可能日調査票の受け取りまでの提出状況管理システム
2. 講習期間におけるコマの割り振り自動化システム
3. 通常授業期間におけるコマの割り振りと変更の自動化システム<br>
    ※ 講習期間におけるプロセスと変わるため別々に明記しております。
4. 本部提出書類作成の自動化システム
5. 業務優先度可視化システム
6. AIエージェントによる学習スケジュール,指導方針策定アシストツール
7. Line連携による簡易編集システム(教務スタッフのみ)における利用方法の説明

## 本システムによる導入効果
本システムの導入により以下の点で業務効率とサービス品質の向上が見られました。
1. 社員の割り振りプロセスの時間短縮やシフト調整の幅が格段に上昇しました。<br>
    社員: コマの割り振り自動化による人員1名削減(今後は、教務スタッフの研修業務を行うことになりました。)
    生徒: 通塾日程をいつでも可視化できること, 教務スタッフの指導技術向上による品質向上

## 今後の展望
<!--今後記入予定-->
今後は、システムエラーの改善と機能増築を目指して日々フォローしていきます。


# 開発環境について
本システムの開発に使用しているローカル環境は以下の通りです。   

> 開発用PC: `Apple MacBook Air M1 2020モデル`   
> 開発時利用ツール: `Visual Studio Code`, `Google Spread Sheet`, `Google Colaboratory`, `Line`   
> 開発時利用言語: `Python`,`SQL`,`HTML`,`CSS`,`JavaScript`   
> 開発に利用しているPythonライブラリ: `Pulp`, `Pandas`, `Matplotlib`,`Numpy`,`Openpyxl`    
> Webアプリケーション利用可能動作環境: `Google Chrome` , `Safari`,`Firefox`

# 1. 問題要件定義
##  1.1. 現時点(2025/02/13)で生じている課題
1. 講習期間,通常授業期間におけるコマ割り振りの業務負荷が高いこと<br>
    ワークフローにおいて生徒それぞれで懸念内容が異なり、それらを総合的に把握する必要がある。そのため、社員が一人で組む必要がありタスク細分化が困難であるとともに、それによる弊害が多数確認できている。
2. 授業準備に割く時間がないこと<br>
    コマの割り振りに時間がかかることにより、生徒の授業日程が直前まで把握できず妥当な授業準備を行えていないこと。また、それにより授業時間内に指導外行為(今後の授業方針の策定や教材確認,テスト等の生徒情報の確認などの教科についての指導ではない部分)を行わざるを得ないこと。
3. 生徒,保護者における授業日程確認が困難であること<br>
    現在の授業日程お知らせのプロセスでは、<strong>来塾可能日の提出->コマの割り振り->授業日程表を紙面で受け渡し</strong>となっている。それにより、授業実施日でないとお知らせできず、授業日当日にお電話でお伝えとなる場合も生じている。また、それにより今後の宿題内容について明確に定めることができず生徒の継続的学習サイクルの阻害にもつながっている。
4. 教務スタッフの研修不足
    教務スタッフを採用してから生徒に指導するまでに約1ヶ月の期間研修業務を行う。しかし、1週間に1回1時間程度授業指導を行う程度であるとともに研修担当もアルバイト(アルバイトに指導の技術がないというのではなく、指導方針や授業実施における注意事項,マニュアル等がなく、研修担当時に個人の経験で指導することになってしまい、属人化してしまっているためアルバイトという書き方をした。)であるため、授業の進め方や指導の明確なコツを取得しない状態で指導を開始している。そのため、授業の品質低下につながっていると考える。実際に、教材や教育指導要領などを確認せずに指導していたことで保護者様からのクレームにつながったこともある。
5. マニュアル不足
    4の内容と類似するのだが、指導マニュアルやコマの割り振りマニュアル,組織のICT機器の操作方法に関する明確なマニュアルがなく口頭で享受する傾向となっている。そのため、現環境を維持するために保守的になっている部分があり変革しづらい環境と言える。

## 1.1 システム化の目的
本プロジェクトでは、現在のシフト管理フローについて課題な負担が生じており、提供するサービスの質悪化に繋がりかねないと判断したため、新システムを構築し、導入する。
## 1.2 背景
私の勤務している個別指導塾では、以下の問題が生じている。
1. シフト提出についての問題
    * シフト提出が紙ベースであり、提出後に社員がエクセルへの入力作業を行うため無駄が生じている。
    * 生徒の予定についても紙面で回収し、同様にpcへ転記している。
    * 教室pcのデータが共有サーバ上にあり、教室内でしか提出したシフトを確認できない。
    * 勤務予定を集約するファイルへのアクセス権限を有するスタッフが限られている。
    
    * シフト提出期間に出勤予定がないスタッフもいるため、コマの割り振りが後に伸びてしまう。
2. コマの割り振りにおけるワークフロー
    * 講師の出勤日程と指導科目, 生徒の来塾可能日程,受講科目,受講コマ数などの制約条件が多い。
    * 振替のコマもあるため、複雑化しやすい
    * コマの割り振り用ファイルへのアクセス権限を有するスタッフが限られるため、確認しにくい。
    * コマの割り振りが延滞することで、授業準備ができずに授業を実施することが多い。
    * コマの割り振りのためのマクロが使われているエクセルファイルがあるものの、使い勝手が悪い。
    * 教室の改装によりブース数が変化するものの、現行のシステムでは対応不可能。
## 1.3 ワークフロー改善における狙い
* シフト提出からコマの割り振りにおけるフローの効率化
* コマの割り振り業務の負担軽減
* 授業状況の共有の易化
* 情報伝達における人為的なミスの減少
## 1.4 ビジネスプロセス関連図
現行のビジネスプロセスについて以下に示す。
<!---後に記述します。-->

## 2. 画面遷移図
画面遷移図を以下に示す。

![画面遷移図](https://github.com/yut0takagi/LP_class/blob/main/fig/%E7%94%BB%E9%9D%A2%E9%81%B7%E7%A7%BB%E5%9B%B3.png?raw=true "Giithub")

### 2.1. 個人情報の編集
#### 2.1.1 個人情報変更について
個人情報の編集は、塾生,講師,管理者問わず、アプリの1ユーザーとしての個人情報編集を意味する。<br>
そのため、変更できる内容を以下のように定義する。
1. 性別<br>
    初期登録の画面にて設定した性別を変更する。<br>
2. 生年月日<br>
    初期登録の画面にて設定した生年月日を変更する。<br>
    ユーザーが学生である場合は、生年月日を学年として利用する。
4. メールアドレス<br>
    初期登録の画面にて設定したメールアドレスを変更する。<br>
    メールアドレスの変更を行なった場合は、メールアドレス確認画面を作成し、登録されたメールアドレスの正当性を確認する。
5. 住所
    <!--住所のデータについては、学習データとしないことに注意する。-->
    初期登録の画面にて設定した住所を変更する。<br>
    住所については任意とし、定期的なチラシ送付と個人成績や学習スケジュールの受信をご希望される方のみの入力とする。
6. 出勤,通塾校舎名と校舎ID<br>
    初期登録の画面にて登録した校舎名と校舎IDを変更する。<br>
    ただし、変更をする場合は管理者の審査を必要とする。
7. アイコンの変更
    ユーザーアイコンを変更する。<br>
    <!--後日精査必要-->
    利用可能拡張子は、<strong>.JPGか.HEIF</strong>とする
8. ログインパスワード<br>
    個人で設定したパスワードを変更する。<br>
    セキュリティ保護のため、変更フォームに入力するページへの遷移はパスワードの入力を必要とする。

<hr>

### 2.2. シフトの提出

### 2.3 生徒管理
### 2.3.1. 生徒追加画面
1. 本機能の操作可能対象者(権限)<br>
    本機能の操作については、管理者権限を有するアカウントのみに表示するものとする。
2. 生徒追加時に入力必須とする情報
    以下に生徒追加時に入力必須とする内容を箇条に構造化して示す。
    1. 生徒氏名(姓と名を別々に,日本語とローマ字で指定)
    2. 生徒管理番号(生徒番号)
    3. 性別
    4. 生年月日
    5. 学年種別
    6. 現時点在籍学校
    7. 経歴(進学等)

### 2.3.4. 授業割り振り画面
授業割り振りは、当初掲げていた改善すべきタスクの中で特に重視すべき問題である。そこで、以下のように改善策を講じる。
1. <strong>線形計画法</strong>による一定期間のコマの割り振り業務効率化   
* 線形計画法とは   
線形計画法とは、ORにおける最適化手法の一つである。<br>
実装方法としては、Python(Pulp)やORtoolsなどが有名である。   
今回は、シンプルで数学的な記述が可能であるPulpを用いる。
* 本タスクへの当てあめ   
本タスクでは、2種類の場合に分けて実装する。
1. 新規に割り振りを行う場合
2. すでに一部もしくは全て割り振りが行われている状況下での割り振りをする場合

### 2.3.4.1. 新規に割り振りを行う場合
新規に割り振りを行う場合には、以下のような制約条件となる。

##### 2.3.4.2. すでに割り振られている範囲への追加を行う場合


<hr>
線形計画法では、目的関数と制約条件を定める必要がある。それぞれ、以下のように定義した。<br>
1. 制約条件について   
    1. *$生徒i$について*   
        * 生徒iが同一の授業時間に複数の授業を受けることができない。
        * 生徒iの授業数は受講申請した授業数と等しくする必要がある。
        * 生徒iの授業は、来塾可能授業時間でなければならない
        * 生徒iの来塾可能日程の回収ができていない場合、授業割り当てができない。
    2. *$講師j$について*   
        * 講師jが同一の授業時間に指導できる生徒数は$C_j$以下である。
        * 講師jが勤務できる授業時間でなければ授業を開講できない
        * 講師jが指導できる教科意外の授業は担当できない
    3. *教室状況,法的観点について*   
        * 稼働講師数は、ブース数以下にする必要がある。
        * 労働基準法により、講師jの週稼働時間が40時間以内にする必要がある。
        * 労働基準法により、講師jの一日の稼働時間が8時間以内にする必要がある。
        * 労働基準法により、講師jの一日の生徒指導時間が6時間以上の場合は、休憩時間1時間を開室時間内に取る必要がある。
2. 目的関数
    生徒の実施授業の割り当ての分散が最大となる割り当てを最適な割り当てとする。
    具体的には、生徒iの単位期間内の授業数が$n$であり実施日が[day_1, day_2, day_3, day_4,,,day_n]である時、それらの分散は以下のように定義できる。   

    $$ Var(x) = \frac{1}{n}\sum_{k=1}^{n}(day_k - \frac{1}{n}\sum_{s=1}^{n}day_s)^2$$ 

    よって、目的変数は、すべての生徒での当該分散の総和と言えるため、以下のように定義する。

    $$ \sum_{i=1}^{I}Var(i) = \sum_{i=1}^{I}( \frac{1}{n}\sum_{k=1}^{n}(day_k - \frac{1}{n}\sum_{s=1}^{n}day_s)^2)$$ 

3. 必要とするデータについて
    実装していく中で、教師や生徒の以下のデータが必要となる。
    1. 生徒の来塾可能日程(時限まで)
    2. 教師の出勤可能日程(時限まで)
    3. 教室の授業可能時限日程(時限まで)
    4. 生徒の受講科目
    5. 教務スタッフの指導可能科目(同一科目でも学年や難易度(学校テスト向けか入試対策までできるのかまで)について)
    6. 科目情報(指導形態)
        * 1:2での指導なのか,1:1のみの指導なのか<br>
        * 教室端末を必要とするか
    7. 教室同時限最大可能授業数(ブース数)
    8. 特記事項情報
        * 特定教師NGに関する制約情報
        * 特定講師優先紐付け
        * 生徒の一日の最大授業数








<br>
<br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br>

1. 教務スタッフの情報を定義
    1. 教務スタッフのyyyy年mm月dd日のnコマ目の入室可否のデータを変数として定義
        ```Python
        teachername_PossTime_yyyymmddn = pulp.LpVariable("teachername_PossTime_yyyymmddn",0,1,"Integer")
        ```
    2. 教務スタッフの科目コードabcdeの授業実施可否についてのデータを定義
        ```Python
        teachername_PossSubject_abcde = pulp.LpVariable("teachername_PossSubject_abcde",0,1,"Integer")
        ```
2. 環境因子の設定
    1. 教室の利用可能ブース数についての定義
        ```Python
        room_n_poss_yyyymmddn = pulp.LpVariable("room_n_poss_yyyymmddn",0,5,"Integer")
        ```
    2. 最大可能授業講師数
        該当時間における最大講師数の定義を行う。例えば、教室のブースが5つ空いている場合は、最大可能授業講師数は5になる。
        ```Python
        booth_num_yyyymmddn = pulp.LpVariable("booth_num_yyyymmddn",0,5,"Integer")
        ```
    3. 講習期間の定義   
        * 開始日: 2024/2/21
        * 終了日: 2024/3/31
        ```Python
        day_open_yyyymmddn = pulp.LpVariable("day_open_yyyymmddn",0,1,"Integer")
        ```
3. 生徒情報の定義
    生徒の来塾可能日程や履修科目やコマ数等について定義する。
    1. 来塾可能日程についての定義
    2. 履修科目の定義
    3. 残りコマ数の定義
    4. 主要な科目担当者の定義
    5. 生徒の情報(学年や性別等,NG講師等)の定義
    6. 備考
    

