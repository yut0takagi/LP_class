# 0. 本リポジトリについて
本リポジトリは、個別指導塾での業務効率化について生じていた課題とその改善についてまとめたものです。DX推進等について実務経験があるわけではなく見よう見真似で実装したものになりますので、参考程度に使ってくださると嬉しいです。よろしくお願いいたします。

# 1. 問題要件について
##  1.1. 現時点(2024年7月12日)で生じている課題
1. <strong>コマの割り振りにおける業務負荷が高く細分化しにくいこと</strong><br>
    当該個別指導塾においてコマの割り振り業務は社員一人が行なっている。具体的には、塾生の来塾可能日程と教務スタッフの出勤可能日程を回収し、それらをもとに教室PCで組んでいく。その中で、生徒の受講科目に対して指導できる教務スタッフが不足していたり生徒,教務スタッフともに来塾可能であるにもかかわらずブースが足りなかったりするなど懸念点,制約条件が多く存在している。そのため、日程が全て完成することはなく常に三日前までに完成させることを目標に実施している状態である。よって、次の来塾日がわからない生徒や教務スタッフの授業準備が厳かになる等の問題が生じており、品質が低下しかねない状況に陥っていた。
2. <strong>シフト提出や日程調査用紙が紙ベースであること</strong><br>
    それらの書類が紙面でやりとりされることに関しては、デジタル化など言われているが受け渡しが楽であり効率が良いのであれば問題視するほどではない。しかし、当該個別指導塾ではそれらの書類を回収してから教室PCのエクセルファイルに転記し、本部へ送る書類とコマの割り振り結果の出力書類を作成している。さらに、転記先のエクセルファイルのフォーマットが操作し難い形式となっており、転記に約2日かかっていた。さらに、その転記を行える教室PCは1台しかないため業務細分化を行えず社員が黙々とやらざるを得ない環境となっていた。そのため、転記の作業が自動化等できれば負担を軽減することができると考える。それに加えて、それらの書類が紙ベースであるからこそ編集,更新,確認くをしにくいという問題が生じている。提出後は一人の社員が管理しており入力状況について他のスタッフが知ることができないため、確認することが困難となる。しかし、小学生から高校生をクライアントとする企業であるからこそ、提出した内容を再度確認,変更したいと申し出る生徒が多数いる。さらに、記入するフォーマットがそれぞれの生徒で異なる(来塾不可能な日にちに斜線を引く生徒と来塾可能な日にちに線を引く生徒,三角を使う生徒,途中までしか記入しない生徒等)などにより入力作業が停滞することが多々ある。しかし、生徒への確認は生徒が来塾していなければできないため非常に非効率な作業となる場合が多い。そのため、紙ベースでの回収には改善する必要があると感じた。
3. <strong>教務スタッフの研修,ミーティング不足</strong><br>
    教務スタッフの研修については、初期研修として採用から1ヶ月間と定期研修として月1回程度行うのが望ましい。そして、定期ミーティングを実施し受験の動向や教務指導の中でのTipsやベストプラクティス,当該個別指導塾ならではの技術共有などをすることで、他者との差別化や品質の向上が望める。しかし、当該個別指導塾では、コマの割り振り業務に社員が追われており全体での情報共有が活発でないなどの理由からミーティングの実施は無くなった。さらに、初期研修ではアルバイトが担当することが頻繁にあり、指導技術が一つの組織として共有されているのではなく完全に属人化してしまっている。そのため、教務指導スタッフの当たり外れが大きいと述べる生徒も多々いる。よって、組織としての統一感をもつ必要がありそれらを共有,享受することを目的としたイベント(ミーティングや研修,指導マニュアルの読み込み等)を実施するべきであると考えた。
4. <strong>マニュアルの不足</strong><br>
    3の内容と酷似するのだが、当該個別指導塾では、指導マニュアルやコマの割り振りマニュアル,組織のICT機器の操作方法に関する明確なマニュアルがなく口頭で伝える傾向になっている。そのため、現環境を維持するために保守的になっている部分があり変革しづらい環境と言える。また、春の時期で教務スタッフの入社タイミングであるのにもかかわらず作成されていないため、非常に働きにくい環境であると言える。

# 2. 具体的な導入システムの設計とその内容
## 2.1. Google Spreadsheetによるシフト管理システムの導入とその運用について(ver.1)
### 開発環境について
本システムの開発に使用しているローカル環境は以下の通りです。   

> 開発用PC: `Apple MacBook Air M1 2020モデル`   
> 教室用PC: `Lenovo ThinkStation`<br>
> 開発時利用ツール: `Google Spread Sheet`, `Line`   
> 開発時利用言語: `GAS`<br>
> 開発に必要な知識: `Line Messaging API`, `Webhook`,    
> 動作可能環境: `Google Chrome` , `Safari`,`Firefox`

### 2.2. 各種機能について
1. Google Spread Sheet でのシフト管理
    Google Spread Sheetを共有し、編集権限を限定付与することでシフト提出をオンライン上で行いました。
    各種ページは以下のとおりです。
    1. <storng>マニュアルページ</storng><br>
        マニュアルページでは、操作方法の説明や動作環境等についてまとめました。
        当該個別指導塾で勤務している教務スタッフは大学生が多く、Lineグループでのアンケート機能を用いた事前調査の中でOffice関連の操作方法はある程度理解している方が多いとわかりました。
        そのため、私が退職しても運用,変更等行えるようにマニュアルとして各種機能をまとめることとしました。その中で、操作を画面録画として保存しGoogleDriveの共有フォルダーにアップロードしておくことで、理解しやすくなると考え、そのリンクをSpreadSheetに掲載することとしました。

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E3%83%9E%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%AB.png)
    
    2. <storng>勤務可能者検索</storng><br>
        シート2枚目には、勤務可能者検索シートを挿れました。当該個別指導塾では教務スタッフの約8割を大学生が占めています。
        そのため、大学の予定等で出勤が急遽難しくなった場合代行者を探す必要があります。
        しかし、先に述べたとおり他の教務スタッフがいつ出勤するのか把握することが困難でした。
        よって、本シートを全教務スタッフの勤務可能調査表と連携することで「誰がいつ出勤できるか」,「この日にこの科目を教えられる人は誰がいるのか」などを表形式で確認できるようにしました。
        さらに、教室でのPCによる代行者検索が頻繁に起きていたため、講師名や出勤可能日,科目等を選択式にして素早く操作できUXの向上を行いました。
        そして、前日や次の日をボタンで操作できる用意するために以下のコードをGoogleAppScriptで実行するようにしました。
        ```GAS
        function addOneDay() {
            var sheet = SpreadsheetApp.getActive().getSheetByName("勤務可能者検索")
            var dateValue = sheet.getRange("B7").getValue();
            dateValue.setDate(dateValue.getDate() + 1);
            sheet.getRange("B7").setValue(dateValue);
        }
        function minusOneDay() {
            var sheet = SpreadsheetApp.getActive().getSheetByName("勤務可能者検索")
            var dateValue = sheet.getRange("B7").getValue();
            dateValue.setDate(dateValue.getDate() - 1);
            sheet.getRange("B7").setValue(dateValue);
        }
        ```

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E5%8B%A4%E5%8B%99%E5%8F%AF%E8%83%BD%E8%80%85%E6%A4%9C%E7%B4%A2%E7%94%BB%E9%9D%A2.png)

    3. <storng>開講コマ設定</storng><br>
        当該個別指導塾では、開講する予定の日時と時間を事前に本部へ提出する必要がありました。
        また、全てを一括で管理するツールがないため、開講する予定でない時間に授業を入れてしまう等のミスが生じやすく振替を組む作業で時間を無駄に費やしてしまうことがありました。
        そのため、申請した開講情報を当該GoogleSpreadSheetに添付することで振替作業や代行検索を楽に行えるようにしました。
        そして、本シートは全てチェックボックスでの入力に書式を限定しており、そのにゅうりょhう情報をもとに勤務可能者検索のページの各セルの背景色を変更するなどの設定を行いました。
        具体的には、m月d日n限目のコマが開講していない場合は背景色を灰色にするなど設定しております。

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E9%96%8B%E8%AC%9B%E3%82%B3%E3%83%9E%E8%A8%AD%E5%AE%9A%E7%94%BB%E9%9D%A2.png)

    4. <storng>管理画面</storng><br>
        管理画面では、講師の追加と削除,シフト提出の該当期間,コマの設定時間,ブース数の設定,受け入れしている学年区分などを指定できるようにしました。
        さらに、勤務可能調査表を編集した際にChengeLogに追加される変更履歴をもとに最終確認日以降に変更された部分を明記する仕組みを取り入れました。
        そして最終更新日を本日にするボタンをGoogleAppScriptで記述し実行するようにしました。
        
        ```GAS
        function setDay(){
            var timeStamp = new Date();  // 現在の時刻
            var sheet = SpreadsheetApp.getActiveSheet();
            sheet.getRange("I3").setValue(timeStamp);
        }
        ```

        以前では、Lineにて社員の方に変更内容を逐一送り紙面と教室PC上で変更作業を実行していたため、勝手に知らない間に変更等は起こりませんでした。
        しかし、GoogleSpreadSheetを利用することでいつでも変更できるというメリットがある反面その変更が周知されておらず、後からタスクが増えてしまうことがありました。
        そのため、ChangeLogを利用して把握できるようにしました。
        そして、シフト提出状況を一括で把握できるように、各シートの入力状況を表と棒グラフで把握することができるようにしました。
        将来的には、シフト提出からコマの割り振りまでを行えるようにしたかったので、ブース数の指定や教室に関する情報を一枚のシートで管理できるようにしました。
        また、教務スタッフが新たに増えた場合は、シフト提出用のシート(氏名_勤務可能調査表)を作成し、講師指導科目のシートに一行追加するなどの作業が必要となります。
        ただ、各シートで記述している関数の中で正規表現を利用しているものが多くあるため入力ミス等が起こり適正な動作をしなかったり全体が小さなミスで使えなくなったりしてしまう場合が多かったです。
        そのため、全ての作業をGoogleAppScriptの関数として設定し、トリガーを管理画面に追加することで上記の操作を自動化しました。実行するGoogleAppScriptのコードは以下のとおりです。
        ```GAS
        function duplicateSheetWithPrompt() {
            var ss = SpreadsheetApp.getActiveSpreadsheet();
            var sheetA = ss.getSheetByName("temp");
            if (!sheetA) {
                Logger.log("指定したtempが見つかりません。管理者へお伝えください。");
                return;
            }
            var ui = SpreadsheetApp.getUi();
            var response = ui.prompt(
                "新規に作成するスタッフ名を入力してください。",
                "ここに入力：",
                ui.ButtonSet.OK_CANCEL
            );
            if (response.getSelectedButton() == ui.Button.OK) {
                var newSheetName = response.getResponseText();
                var newSheet = sheetA.copyTo(ss).setName(newSheetName + "_勤務可能調査表");
                newSheet.getRange("A1").setValue(newSheetName);
            } else {
                Logger.log("シート複製をキャンセルしました。");
            }
        }
        ```

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2.png)

    5. <storng>ChangeLog 変更履歴自動記録画面</storng><br>
        管理画面の項で示した通り、変更履歴を自動で記録するシートを導入しました。
        初期の段階では、変更したら変更箇所を各自記入するようにしていましたが、面倒であり入力作業を忘れる等のミスが多発しました。
        そこで、GoogleAppScriptを用いて自動で記録するような関数を以下のようにコーディングして、運用しました。

        ```gas
        function onEditRecordLogAAA(e) {
        // --------------------------------------------------------------------------------
        // 1. 編集されたシート名をチェック
        // --------------------------------------------------------------------------------
        var editedSheet = e.range.getSheet();
        var editedSheetName = editedSheet.getName();
        // シート名に "勤務可能調査表" が含まれていない場合は処理しない
        if (editedSheetName.indexOf("勤務可能調査表") === -1) {
            return;
        }
        // --------------------------------------------------------------------------------
        // 2. ログを残すシートを指定
        // --------------------------------------------------------------------------------
        var ss = SpreadsheetApp.getActiveSpreadsheet();
        var logSheetName = "ChangeLog";
        var logSheet = ss.getSheetByName(logSheetName);
        // もしログ用シートが存在しない場合はスキップ or 必要に応じて作成
        if (!logSheet) {
            Logger.log("ログシート '" + logSheetName + "' が存在しません。");
            return;
        }
        // --------------------------------------------------------------------------------
        // 3. 変更されたセル情報を取得
        // --------------------------------------------------------------------------------
        var editedRange = e.range;             // 変更されたセル範囲 (Rangeオブジェクト)
        var oldValue = e.oldValue;            // 変更前の値 (インストール型トリガー必要)
        var newValue = e.value;               // 変更後の値 (インストール型トリガー必要)
        var cellA1Notation = editedRange.getA1Notation();
        // --------------------------------------------------------------------------------
        // 4. 編集ユーザーを取得 (環境によって取得できない場合あり)
        // --------------------------------------------------------------------------------
        var userEmail = (e.user) ? e.user.getEmail() : "不明";
        // --------------------------------------------------------------------------------
        // 5. ログの書き込み
        // --------------------------------------------------------------------------------
        var timeStamp = new Date();  // 現在の時刻
        var write_sheet = "_勤務可能調査表"
        var manageSheet = SpreadsheetApp.getActive().getSheetByName("管理画面")
        for (let i = 18; i < 35; i++) {
            if (editedSheetName ==  manageSheet.getRange("B"+i).getValue()+ write_sheet){
            manageSheet.getRange("D"+i).setValue(timeStamp)
            }
        }

        logSheet.appendRow([
            timeStamp,            // A列: 日時
            editedSheetName,      // B列: シート名
            cellA1Notation,       // C列: 変更セル(A1表記)
            oldValue,             // D列: 旧値
            newValue,             // E列: 新値
            userEmail             // F列: ユーザー
        ]);
        }
        ```

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/ChangeLog%20%E5%A4%89%E5%B1%A5%E6%AD%B4%E8%87%AA%E5%8B%95%E8%A8%98%E9%8C%B2%E7%94%BB%E9%9D%A2.png)

    6. <storng>簡易確認シート</storng><br>
        シフト提出されたシートを移動して確認する作業が非常に面倒であるため、確認用のシートを作成しました。
        具体的にはA1セルの氏名を選択すると該当する講師の勤務可能状況を見ることができるようにしています。

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E9%96%8B%E8%AC%9B%E3%82%B3%E3%83%9E%E8%A8%AD%E5%AE%9A%E7%94%BB%E9%9D%A2.png)

    7. <strong>指導可能科目入力画面</strong><br>
        教務スタッフがお互いの授業を見るといった機会が少なく、「誰がどの科目をどのレベルまで指導できるのか」を把握することができませんでした。
        そのため、コマの割り振り後に、指導負荷であることが判明し代行を探すなどのミスが多発していました。そのため、本ファイルを導入してから1週間以内に入力をお願いし、勤務可能者検索の画面等へ反映できるようにしました。

        ![fig](https://github.com/yut0takagi/LP_class/blob/main/fig/GoogleSpreadSheet%E6%93%8D%E4%BD%9C%E7%94%BB%E9%9D%A2/%E6%8C%87%E5%B0%8E%E5%8F%AF%E8%83%BD%E7%A7%91%E7%9B%AE%E5%85%A5%E5%8A%9B%E7%94%BB%E9%9D%A2.png)

    8. <strong>出勤可能時間時間入力画面(講師1_勤務可能調査表)</strong><br>
        